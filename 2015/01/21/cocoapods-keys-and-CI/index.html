<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    CocoaPods-Keys and CI // Artsy Engineering
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="orta">
<meta name="generator" content="Hugo 0.26" />

  <meta property="og:title" content="CocoaPods-Keys and CI" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://hizkifw.github.io/artsy.github.io-hugo/2015/01/21/cocoapods-keys-and-CI/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="https://hizkifw.github.io/artsy.github.io-hugo/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Artsy Engineering" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	

    
    

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="https://hizkifw.github.io/artsy.github.io-hugo">Home</a></li>
        
      </ul>
    </nav>

    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
		    <div id="toc" class="pure-u-1 pure-u-md-1-4">
				<small class="toc-label">Contents</small>
		   	 	<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#the-easy-way">The easy way.</a></li>
<li><a href="#the-fully-featured-way">The fully featured way</a></li>
</ul></li>
</ul>
</nav>
		    </div>
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/artsy.github.io-hugo/2015/01/21/cocoapods-keys-and-CI/">CocoaPods-Keys and CI</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>21</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Jan</span> <span class="post-date-year">2015</span>
            	</span>
            	
            
            	
            		<span class="post-author-single">By <a class="post-author"  target="">orta</a></span>
            		




            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-iOS" href="https://hizkifw.github.io/artsy.github.io-hugo/categories/iOS">iOS</a>
				
					<a class="post-category post-category-mobile" href="https://hizkifw.github.io/artsy.github.io-hugo/categories/mobile">mobile</a>
				
				</div>
			

			

			

            <p>We built CocoaPods-Keys as a way to remove API keys and secrets from our source code. We use it to open up our code to the public, without leaking private details. One of the cool things about doing it this way was that we could all use different API keys stashed away in each developers Keychain.</p>

<p>To ensure we could run CI on our apps we came up with two different ways to use keys on CI. This post explains them both.</p>

<p></p>

<h2 id="the-easy-way">The easy way.</h2>

<p>Depending on your use-case, you may not need to use the keys at all in your testing. This works really well if you&rsquo;re using stubbed network requests. So if you have a keys definition in your <a href="https://github.com/artsy/eidolon/blob/9a918108e717a68a45709345f38d55e0eeb1f8b3/Podfile#L4-L21">Podfile</a> like this:</p>

<pre><code class="language-ruby">plugin 'cocoapods-keys', {
  :project =&gt; &quot;Eidolon&quot;,
  :target =&gt; &quot;Kiosk&quot;,
  :keys =&gt; [
    &quot;ArtsyAPIClientSecret&quot;,
    &quot;ArtsyAPIClientKey&quot;,
  ]
}
</code></pre>

<p>Before the CI runs <code>pod install</code> you will want ensure you have already set the keys to be dummy data. So in either your <code>install:</code> or <code>before_install:</code> add commands like the following:</p>

<pre><code>	bundle exec pod keys set ArtsyAPIClientSecret &quot;-&quot; Eidolon
	bundle exec pod keys set ArtsyAPIClientKey &quot;-&quot;

</code></pre>

<p>This will set up the keys beforehand with the right target name.</p>

<h2 id="the-fully-featured-way">The fully featured way</h2>

<p>If you need to have full access to an API with secret keys, we recommend using the CI&rsquo;s private environment keys feature. You can see the technique being used here in Eidolon, starting on <a href="https://github.com/artsy/eidolon/blob/master/.travis.yml#L5">line 5</a> we declare a secure environment key <code>GITHUB_API_KEY</code> in that hash. Then it is used on <a href="https://github.com/artsy/eidolon/blob/aa8e8447f797c483ff72148d124d2930b58a42e7/.travis.yml#L8">line 8</a> to set up our <code>~/.netrc</code>.</p>

<p>To get started on Travis CI you will need to install the travis gem, and go through the <a href="http://docs.travis-ci.com/user/environment-variables/">Environment Variables</a> section of their documentation. Notably the <a href="http://docs.travis-ci.com/user/environment-variables/#Secure-Variables">Secure Variables</a> section. In a gist, you run <code>travis encrypt ARTSYAPICLIENTSECRET=super_secret_yo</code> and it gives you the secure string.</p>

<p>You can then use the new keys in your <code>before:</code> section:</p>

<pre><code>	bundle exec pod keys set ArtsyAPIClientSecret $ARTSYAPICLIENTSECRET Eidolon
	bundle exec pod keys set ArtsyAPIClientKey $ARTSYAPICLIENTKEY

</code></pre>

<p>That&rsquo;s a wrap. We don&rsquo;t use the second technique in any OSS repos, though there is talk of doing it on our <a href="https://github.com/artsy/Artsy_Authentication/">Artsy Authentication</a> pod. So if you&rsquo;re in my future ðŸ‘‹, maybe give that a look over as an example of the latter.</p>
	
			

			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/artsy.github.io-hugo/2015/03/23/artsy-technology-stack-2015/">Artsy&#39;s Technology Stack, 2015</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/artsy.github.io-hugo/2015/01/04/cocoapods-and-frameworks/">CocoaPods and Frameworks</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2017. All rights reserved.</p>
</div>
    </div>
  </div>
	

	

  
</body>
</html>
